# 🧩 코딩 테스트 & 코드 실행 로직 완전 해부

이 문서는 사용자가 "코드 제출"을 했을 때 서버 내부에서 일어나는 모든 과정을 **라인(Line) 단위 범위**로 찍어서 설명합니다.

---

## 1. 채점 요청 접수 (Controller)
사용자가 푼 코드가 제일 먼저 도착하는 곳입니다.

*   **파일**: `src/main/java/com/mysite/clover/Problem/ProblemController.java`
*   **영역**: **55번째 줄 ~ 136번째 줄** (`submitCode` 메서드 전체)

| 라인 범위 | 하는 일 | 설명 |
| :--- | :--- | :--- |
| **59 ~ 60** | **정답지 준비** | 풀려는 문제(`Problem`)와 정답 데이터(`testCases`)를 DB에서 꺼내옵니다. |
| **73 ~ 104** | **반복문 채점** | 테스트 케이스가 5개면 5번 반복(`for`)하면서 채점을 시도합니다. |
| **77 ~ 80** | **실행 요청** | 사용자 코드와 이번 테스트 케이스의 입력값을 묶어서 포장(`ExecutionRequest`)합니다. |
| **82번** | **하청 맡기기** | "야, 이거 실행해봐!" 하고 `codeExecutor.run()`을 호출합니다. (여기가 핵심) |
| **86 ~ 94** | **에러 체크** | 컴파일 에러가 나거나 실행 중 뻗어버리면 바로 `FAIL` 처리하고 끝냅니다. |
| **97 ~ 102** | **정답 확인** | 실행 결과(`actual`)와 정답(`expected`)이 똑같은지 비교합니다. 맞으면 `passedCount` 증가! |
| **112 ~ 126** | **이력 저장** | `SubmissionService`를 불러서 "이 사람, 이 문제 풀었음" 하고 DB에 기록합니다. |

---

## 2. 실제 코드 실행 (Executor)
위에서 "하청 맡기기" 했을 때 실제로 일하는 공장입니다.

*   **파일**: `src/main/java/com/mysite/clover/Problem/JavaNativeExecutor.java`
*   **영역**: **19번째 줄 ~ 94번째 줄** (`run` 메서드 전체)

| 라인 범위 | 하는 일 | 설명 |
| :--- | :--- | :--- |
| **25번** | **방 만들기** | 남의 코드랑 섞이지 않게 `java-exec-xxxx` 라는 임시 폴더를 만듭니다. |
| **28 ~ 30** | **파일 생성** | 받은 String 코드를 실제 `Main.java` 파일로 저장합니다. |
| **33 ~ 35** | **컴파일** | `javac` 명령어를 몰래 실행해서 `.java`를 `.class`로 번역합니다. |
| **41 ~ 47** | **컴파일 체크** | 번역하다 에러 나면(오타 등) 바로 "컴파일 에러"라고 보고하고 끝냅니다. |
| **50 ~ 52** | **실행 (Run)** | `java Main` 명령어로 프로그램을 실행시킵니다. |
| **55 ~ 59** | **입력 넣기** | 프로그램에 키보드 입력(`System.in`)을 넣어줍니다. |
| **63 ~ 72** | **시간 제한** | `10초` 동안 안 끝나면 무한루프로 간주하고 강제로 끕니다(`destroy`). |
| **74 ~ 81** | **결과 수집** | 화면에 출력된 내용(`System.out`)을 싹 긁어모아서 반환합니다. |
| **90 ~ 93** | **뒷정리** | 다 썼으니 만들었던 임시 폴더와 파일들을 지웁니다. (`finally` 블록) |

---

## 3. 기록 저장 (Service)
채점이 다 끝나고 성적표를 저장하는 곳입니다.

*   **파일**: `src/main/java/com/mysite/clover/Submission/SubmissionService.java`
*   **영역**: **18번째 줄 ~ 28번째 줄** (`create` 메서드)

| 라인 범위 | 하는 일 | 설명 |
| :--- | :--- | :--- |
| **19 ~ 25** | **성적표 작성** | `Submission` 객체를 만들어서 누가, 언제, 무슨 코드로, 몇 점 맞았는지 채워 넣습니다. |
| **27번** | **도장 쾅** | `submissionRepository.save()`로 DB에 영구 저장합니다. |

---

## 💡 요약
1.  **ProblemController (55~136줄)**: 전체 감독관. 정답지 들고 채점 매기는 역할.
2.  **JavaNativeExecutor (19~94줄)**: 실무 작업자. 격리된 방에서 코드 돌려보고 결과만 갖다주는 역할.
3.  **SubmissionService (18~28줄)**: 서기. 결과 나오면 장부에 기록하는 역할.
